# 概述

## 系统调用

用户态 

核心态  访问资源不受限 占用cpu不抢占 

用户态 trap->核心态

## 中断

如何使cpu感知中断 硬件中断 （内外中断）+软件中断 INT 指令

An interrupt is an asynchronous event that is typically triggered by an I/O device.

中断也就是外中断 io中断 

An exception is a synchronous event that is generated when the processor detects one or more predefined conditions while executing an instruction.

异常也就是内中断 trap 系统调用 fault 缺页中断 abort 除0

关中断

保护现场

请求中断

恢复线现场

开中断



# 进程管理

## 进程和线程的区别

进程是运行时程序的封装，并发

1.资源

进程是资源分配的基本单位，线程访问进程的资源，多个线程共享进程的资源

2.调度

线程是独立调度的基本单位，进程间线程切换不会引起进程上下文切换，而线程上下文切换比进程上下文切换要快得多。

3.开销

一大一小

进程奔溃线程也奔溃，

## 进程切换和线程切换的区别

进程切换

## 五种状态

Create-------->Ready<---------->Runnable------>terminated

​							 <----waiting<---

## 进程通信方式

socket 多机

共享内存 速度快 进程安全问题

mq 容量以及大小受限

管道 速度慢 半双工容量有限 匿名管道 父子进程和命名管道 任意进程

信号

semaphore  只能同步

## 线程同步机制

临界区

信号量 semphare

互斥量 mutex

事件 callback wait notify

## 用户级线程和内核级线程

用户级线程 cpu内核只能感知到进程

内核级线程 cpu内核可以感知到线程

##进程调度策略

先来先服务   短作业优先   时间片轮转    优先级调度

## 临界资源和临界区

一次只有一个进程使用的资源 ，访问临界资源的代码是临界区

## 死锁

请求保持   互斥访问   循环等待  不抢占

# 内存管理

## 各种地址

物理地址 内存的绝对地址

偏移地址(有效地址) offset

逻辑地址   段地址和偏移量

线性地址  保护模式的段地址和偏移量 段地址先去GDT（全局描述表）找真正的段地址

虚拟地址  如果线性地址开启了分页 那么还不能直接把找到的段地址+偏移量作为物理地址，所以叫为虚拟地址

## 连续分配

### 动态分区算法

最佳适应 最坏适应 邻近适应

## 非连续分配

### 分页 

内存大小为X，页面大小为Y,页表项个数为X/Y,根据X/Y和8的关系，可以判断页表项大小为多少B

提高内存空间利用率

![img](http://blog-img.coolsen.cn/img/image-20210610173249387.png)

每个进程一个页表，页表项记录页号和块号，知道物理内存和页面大小即可知道页表项数量，知道页表在内存的起始位置就可以知道页表项的内存位置,页号也就隐藏了

通过逻辑地址x可以算出页号  x/页面大小，偏移地址 x%页面大小

**两级分页**

因为页表需要连续存放，当页表项数量较多时，仍要占用较大连续的内存，可以将页表项再放到离散的地方，通过再建立一张页表进行映射查找

### 分段

满足逻辑需求

![img](http://blog-img.coolsen.cn/img/image-20210610173410509.png)

和页表不一样的是段长不固定，所以是二维的基址和段长(偏移量)

### 段页式

![img](https://img2018.cnblogs.com/blog/1358881/201910/1358881-20191024165237632-1280186867.png)

### 请求分页

![img](https://images2015.cnblogs.com/blog/703944/201512/703944-20151203221551861-509555015.png)

换进和换出的功能

## 交换空间

物理内存和硬盘进行交换以释放空间，硬盘上的空间就叫交换空间，物理内存+交换空间就是虚拟内存的容量

## 页面置换算法

最佳置换(需要知道后序访问页面不可实现)

FIFO

LRU

 NRO Not Recently Used  每个页面两个状态R(读) M(写) R定时置0并按照其大小00 01 10 11 越小越被换出 

## 虚拟内存

**虚拟地址**

- 虚拟地址是程序在虚拟空间生成的地址，类似于上一篇讲的逻辑地址，它不是真实的物理地址，需要通过一定的转换才能得到物理地址。

- 简单虚拟地址结构，分为两部分，前n位表示页编号，后m位表示偏移量

  [![img](https://houwanfei.github.io/images/virtual_address.png)](https://houwanfei.github.io/images/virtual_address.png)

- 一个例子：假设一个系统页大小为4Kb，而应用程序需要的空间为64Kb，虚拟页有16个，因此页编号需要4位，而偏移量需要12位，总共16位就可以表示虚拟地址

# 设备管理

## 磁盘调度算法

FIFO

最短寻道 贪心

电梯 先左后右或者先右后左

# IO

## 演变

初始

cpu从控制两次拷贝 一次是磁盘到pagecache 一次是pagecache到用户缓冲区

<img src="F:\资料\八股复习\冲冲冲\操作系统\images\I_O 中断.png" alt="I_O 中断" style="zoom:50%;" />



加入DMA

DMA控制一次拷贝 一次是磁盘到内核缓冲区

CPU控制一次拷贝 一次是内核到用户缓冲区

<img src="F:\资料\八股复习\冲冲冲\操作系统\images\DRM I_O 过程.png" alt="DRM I_O 过程" style="zoom:50%;" />

<img src="F:\资料\八股复习\冲冲冲\操作系统\images\传统文件传输.png" alt="传统文件传输" style="zoom:50%;" />

# Linux