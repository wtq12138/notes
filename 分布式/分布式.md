# CAP

分布式系统不可能同时满足一致性（C：Consistency）、可用性（A：Availability）和分区容忍性（P：Partition Tolerance），最多只能同时满足其中两项。

# 一致性算法RAFT

leader follower candidate

**leader election** 

客户端访问节点时必须经过leader控制，每个节点在无leader时都会自旋一个随机时间election timeout，时间一到就会成为candidate 开始election 

candidate向follower发送消息请求投票

每个节点vote后，刷新 election timeout，candidate变为leader后，向所有follower发送heartbeat，携带log进行数据一致操作即log replication

headbeat时有同样有一个 timeout，如果leader挂掉 ，仍然会出现一个candidate，开始election并成为leader 重复上述

多个candidate

**log replication**

所有操作必须收到回复后才会执行

leader向所有follower发送heartbeat，follower收到log但不执行而是返回leader消息，leader收到大部分回复后，才将操作执行并向客户端回复确认，follower在下一个headbeat收到消息时，才执行上步的log

当故障出现分区时，每个分区会出现一个领导，而恢复后会选择一个vote轮次多的成为新领导

# BASE理论

BASE 是基本可用（Basically Available）、软状态（Soft State）和最终一致性（Eventually Consistent）

降级  中间状态

# 熔断降级限流

熔断指某服务挂掉，之后不调用它直接返回降级数据

降级指保留核心业务，其他业务直接返回降级数据

# 解决方案

## 2PC

两阶段提交（Two-phase Commit，2PC），通过引入协调者（Coordinator）来协调参与者的行为，并最终决定这些参与者是否要真正执行事务

## 柔性事务

尽力去通知但是不保证